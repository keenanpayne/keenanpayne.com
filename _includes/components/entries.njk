{# Imports #}
{% import "atoms/label.njk" as label with context %}
{% import "molecules/entry.njk" as entry %}
{% import "organisms/entries/transformers.njk" as transformers %}
{% import "organisms/entries/filters.njk" as filters %}

{# Component Settings #}
{% set heading = section.heading %}
{% set items = section.items %}
{% set spacing = section.spacing %}
{% set orientation = section.orientation %}
{% set columns = section.columns %}
{% set showCovers = section.showCovers %}
{% set layout = '-' ~ orientation ~ '-' ~ columns ~ '-columns' %}

{# Markup #}
<section class="collections _container" style="--top-margin: {{ spacing | default(0) }}">
  {{ label.output(heading, 'collections-label' )}}

  {% if items %}
    {% set itemClass = orientation and columns ? layout : '-' ~ orientation %}
    <div class="collections-items {{ itemClass }}">
      {% set itemsFrom = items.from %}
      {% set itemsLimit = items.limit %}
      {% set featured = items.featured %}
      {% set collection = collections[itemsFrom] | head(-itemsLimit) %}
      {% set tag = tag %}
      {% set type = type %}

      {% if collection.length %} 
        {# Posts #}
        {% if itemsFrom == 'featured' or itemsFrom == 'posts' %}
          {% if tag %}
            {% for post in filters.filterPostsByTag(collection, tag) %}
              {% set entryCover, entryTitle, entryLede, entryUrl, entryMore = transformers.transformPost(post) %}
              {{ entry.output(showCovers, entryCover, entryTitle, entryLede, entryUrl, entryMore) }}
            {% endfor %}
          {% elif type %}
            {% for post in filters.filterPostsByType(collection, type) %}
              {% set entryCover, entryTitle, entryLede, entryUrl, entryMore = transformers.transformPost(post) %}
              {{ entry.output(showCovers, entryCover, entryTitle, entryLede, entryUrl, entryMore) }}
            {% endfor %}
          {% else %}
            {%- for post in collection | reverse -%}
              {% set entryCover, entryTitle, entryLede, entryUrl, entryMore = transformers.transformPost(post) %}
              {{ entry.output(showCovers, entryCover, entryTitle, entryLede, entryUrl, entryMore) }}
            {% endfor %}
          {% endif %}

        {# Portfolio #}
        {% elif itemsFrom == 'portfolio' %}
          {% for item in filters.filterPortfolioItems(portfolio, featured) %}
            {% set cover, name, lede, url, more = transformers.transformPortfolioItem(item) %}
            {{ entry.output(showCovers, cover, name, lede, url, more) }}
          {% endfor %}

        {# Services #}
        {% elif itemsFrom == 'services' %}
          {% for service in collection | sort(attribute='data.order') %}
            {% set entryCover, entryTitle, entryLede, entryUrl, entryMore = transformers.transformService(service) %}
            {{ entry.output(showCovers, entryCover, entryTitle, entryLede, entryUrl, entryMore) }}
          {% endfor %}
        {% endif %}
      {% else %}
        {% set content = 'No content is published here yet.' %}
        {% include "type/notice.html" %}
      {% endif %}
    </div>
  {% endif %}
</section>