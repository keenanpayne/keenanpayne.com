{# Component Settings #}
{% set id = section.id %}

{% if id %}
  {% for testimonial in collections.testimonials %}
    {% if testimonial.id == id %}
      <blockquote class="testimonial">
        {% if testimonial.content %}
          <div class="testimonial-content">
            {% if testimonial.content | length > 250 %}
              <p class="testimonial-text _type-my-voice testimonial-text-trimmed">
                <span>{{ testimonial.content | truncate(250) | safe }}</span>
              </p>
              <p class="testimonial-text _type-my-voice testimonial-text-full _a11y-hidden">
                <span>{{ testimonial.content | safe }}</span>
              </p>
              <button class="testimonial-toggle" onclick="toggleTestimonial(this)">
                Read more
              </button>
            {% else %}
              <p class="testimonial-text _type-my-voice">
                <span>{{ testimonial.content | safe }}</span>
              </p>
            {% endif %}
          </div>
        {% endif %}

        {% for person in collections.people %}
          {% if person.id == testimonial.person_id %}
            <cite class="testimonial-cite">
              {% if person.image %}
                <img class="testimonial-image" src="{{ person.image }}" alt="{{ person.name }}" />
              {% endif %}

              <p class="testimonial-author">
                {%- if person.name -%}
                  <span class="testimonial-name _text-h5">
                    {{- person.name -}}
                  </span>
                {%- endif -%}

                {%- if person.position -%}
                  <span class="testimonial-position">
                    {{- person.position -}}
                  </span>
                {%- endif -%}
              </p>
            </cite>
          {% endif %}
        {% endfor %}
      </blockquote>

      <script>
        function toggleTestimonial(button) {
          const container = button.closest('.testimonial-content');
          const trimmed = container.querySelector('.testimonial-text-trimmed');
          const full = container.querySelector('.testimonial-text-full');
          
          if (full.classList.contains('_a11y-hidden')) {
            trimmed.classList.add('_a11y-hidden');
            full.classList.remove('_a11y-hidden');
            full.classList.add('_a11y-visible');
            button.textContent = 'Show less';
          } else {
            trimmed.classList.remove('_a11y-hidden');
            full.classList.add('_a11y-hidden');
            full.classList.remove('_a11y-visible');
            button.textContent = 'Read more';
          }
        }
      </script>
    {% endif %}
  {% endfor %}
{% endif %}