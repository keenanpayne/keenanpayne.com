---
layout: layouts/base.njk
permalink: "/{{ title | slug }}/"
---
{# TODO: Create macros for repeated elements here and in `postslist.njk` #}

<section class="post _container">
  <header class="post-header">
    <div class="post-meta">
      {%- if type -%}
        <a class="postlist-type _label" href="/type/{{ type | lower | plural }}" title="View archive for {{ type | lower | plural }}">
          {{ type }}
        </a>
      {%- endif -%}

      <time class="_text-smaller" datetime="{{ page.date | htmlDateString }}">
        {{ page.date | readableDate }}
      </time>
    </div>

    <h1 class="post-title">
      {{ title }}
    </h1>

    {%- if tags -%}
      <div class="post-tags">
        {%- for tag in tags | filterTagList -%}
          <div class="post-tag">
            {%- set tagUrl %}/tags/{{ tag | slug }}/{% endset -%}

            <a href="{{ tagUrl | url }}" class="tags">
              {{ tag }}
            </a>
          </div>
        {%- endfor -%}
      </div>
    {%- endif -%}
  </header>

  <div class="post-content">
    {{ content | safe }}
  </div>

  {%- set nextPost = collections.posts | getNextCollectionItem(page) %}
  {%- set previousPost = collections.posts | getPreviousCollectionItem(page) %}

  {%- if nextPost or previousPost -%}
    <div class="postNav">
      <p class="postNav-next">
        {%- if nextPost -%}
          <span class="postNav-label _label">
            Next
          </span>
          
          <a href="{{ nextPost.url | url }}">
            {{ nextPost.data.title }}
          </a>
        {%- endif -%}
      </p>

      <p class="postNav-prev">
        {%- if previousPost -%}
          <span class="postNav-label _label">
            Previous
          </span>
          
          <a href="{{ previousPost.url | url }}">
            {{ previousPost.data.title }}
          </a>
        {%- endif -%}
      </p>
    </div>
  {%- endif -%}
</section>

{# TODO: Lazy-load comments #}
<div id="disqus_thread"></div>

<noscript>Please enable JavaScript to view the comments.</noscript>

<script> 
  // Disqus configuration   
  var disqus_config = function () {
    this.page.url = 'https://keenanpayne.com{{ permalink }}'; 
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://keenan-payne.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();

  // Disqus theme switching
  // Ref: https://thisdevbrain.com/disqus-auto-theme-switching/
  document.addEventListener('themeChanged', function (e) { 
    if (document.readyState == 'complete') {
      DISQUS.reset({ reload: true, config: disqus_config });
    }
  });
</script>

{% include "newsletter.njk" %}
