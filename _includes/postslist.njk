{# TODO: Most recent article tagged "featured" #}
{%- if postslistfeatured -%}
  <section class="v2-postlist-featured">
    {% if label %}
      <div class="v2-postlist-label _label">
        Featured
      </div>
    {% endif %}

    <div class="v2-postlist-items">
      {# Check if items exist in collection #}
      {% if postslistfeatured.length %}
        {%- for post in postslistfeatured | reverse -%}
          <div class="v2-postlist-image" style="background: url('{% first_image_link post %}') no-repeat center center / cover; background-size: cover;"></div>
          
          {% set date = post.data.date %}
          {% set type = post.data.type %}
          {% set title = post.data.title %}
          {% set lede = post.data.lede %}

          <article class="v2-postlist-item{% if post.url == url %} postlist-item-active{% endif %}">
            <div class="postlist-meta">
              {%- if type -%}
                <a class="postlist-type _label" href="/type/{{ type | lower | plural }}" title="View archive for {{ type | lower | plural }}">
                  {{ type }}
                </a>
              {%- endif -%}

              {%- if date -%}
                <time class="postlist-time _text-small" datetime="{{ date | htmlDateString }}">
                  <span class="postlist-time-month">
                    {{ date | postMonth }}
                  </span>

                  <span class="postlist-time-year">
                    {{ date | postYear }}
                  </span>
                </time>
              {%- endif -%}
            </div>

            <header class="postlist-header">
              <h2 class="postlist-title _text-h2">
                <a href="{{ post.url | url }}" class="postlist-link">
                  {% if title %}
                    {{ title }}
                  {% else %}
                    <code>{{ post.url }}</code>
                  {% endif %}
                </a>
              </h2>
            </header>

            {% if lede %}
              <p class="postlist-lede _text-h5">
                {{ lede }}
              </p>
            {% endif %}

            <p>
              <a class="postlist-articleLink _label" href="{{ post.url }}" title="Read {{ title }}">
                Read {{ type }}
              </a>
            </p>

            {% if postsListTags !== false %}
              <ul class="postlist-tags">
                {%- for tag in post.data.tags | filterTagList -%}
                  <li class="postlist-tag ">
                    {% set tagUrl %}/tags/{{ tag | slug }}/{% endset %}

                    {% if tag == "drafts" %}
                      <span class="tag -inactive">
                        {{ tag | replace('drafts', 'draft') }}
                      </span>
                    {% else %}
                      <a href="{{ tagUrl | url }}" class="tag">
                        {{ tag }}
                      </a>
                    {% endif %}
                  </li>
                {%- endfor -%}
              </ul>
            {% endif %}
          </article>
        {%- endfor -%}
      {%- endif -%}
    </div>
  </section>
{%- endif -%}

{# TODO: Create macros for repeated elements here and `post.njk` #}
<section class="postlist -stack _container">
  {% if label or tag %}
    <div class="postlist-header">
      <div class="postlist-label">
        {{ label if label else 'Tagged: ' ~ tag }}
      </div>

      {% if description %}
        <p class="_text-small">
          {{ description | safe }}
        </p>
      {% endif %}
    </div>
  {% endif %}

  <div class="postlist-items">
    {# Check if items exist in collection #}
    {% if postslist.length %}
      {%- for post in postslist | reverse -%}
        {% set date = post.data.date %}
        {% set type = post.data.type %}
        {% set tags = post.data.tags %}

        {# Exclude featured posts #}
        {%- if not tags.includes('Featured') -%}
          {% first_image post %}

          <article class="postlist-item{% if post.url == url %} postlist-item-active{% endif %}">
            <div class="postlist-meta">
              {%- if type -%}
                <a class="postlist-type _label" href="/type/{{ type | lower | plural }}" title="View archive for {{ type | lower | plural }}">
                  {{ type }}
                </a>
              {%- endif -%}

              {%- if date -%}
                <time class="postlist-time _text-small" datetime="{{ date | htmlDateString }}">
                  {{ date | readableDate }}
                </time>
              {%- endif -%}
            </div>

            <header class="postlist-header">
              <h2 class="postlist-title _text-h3">
                <a href="{{ post.url | url }}" class="postlist-link">
                  {% if post.data.title %}
                    {{ post.data.title }}
                  {% else %}
                    <code>{{ post.url }}</code>
                  {% endif %}
                </a>
              </h2>

              {% if post.data.lede %}
                <p class="postlist-lede">
                  This is a lede for the article that will be displayed in multiple contexts — meta description, tiles, and article header.
                </p>
              {% endif %}
            </header>

            {% if postsListTags !== false %}
              <ul class="postlist-tags">
                {%- for tag in tags | filterTagList -%}
                  <li class="postlist-tag ">
                    {% set tagUrl %}/tags/{{ tag | slug }}/{% endset %}

                    {% if tag == "drafts" %}
                      <span class="tag -inactive">
                        {{ tag | replace('drafts', 'draft') }}
                      </span>
                    {% else %}
                      <a href="{{ tagUrl | url }}" class="tag">
                        {{ tag }}
                      </a>
                    {% endif %}
                  </li>
                {%- endfor -%}
              </ul>
            {% endif %}
          </article>
        {%- endif -%}
      {%- endfor -%}
    </div>
  
  {# If collection is empty #}
  {% else %}
    {% set content = 'No content is published here yet.' %}

    {% include "type/notice.html" %}
  {% endif %}

  {% if tag or postListReadMore %}
    <p class="postlist-tagsLink _text-align-center">
      {% if tag %}
        <a href="{{ '/tags/' | url }}">All Tags →</a>
      {% elif postListReadMore %}
        <a href="{{ '/archive/' | url }}">View Archive →</a>
      {% endif %}
    </p>
  {% endif %}
</section>