{# Filters for different entry types in the collections component
   These macros handle the filtering and selection of items to display
   based on various criteria like tags, types, and featured status #}

{# Filters posts by a specific tag
   Args:
     collection: The collection of posts to filter
     tag: The tag to filter by
   Returns:
     Filtered collection of posts that have the specified tag
   Note:
     Reverses the collection to show newest posts first
     Returns empty array if collection or tag is missing #}
{% macro filterPostsByTag(collection, tag) %}
  {% if not collection or not tag %}
    {{ [] }}
  {% else %}
    {% set filtered = [] %}
    {% for post in collection | reverse %}
      {% if post.data.tags and post.data.tags.includes(tag) %}
        {% set filtered = filtered | push(post) %}
      {% endif %}
    {% endfor %}
    {{ filtered }}
  {% endif %}
{% endmacro %}

{# Filters posts by a specific type
   Args:
     collection: The collection of posts to filter
     type: The type to filter by
   Returns:
     Filtered collection of posts that match the specified type
   Note:
     Reverses the collection to show newest posts first
     Returns empty array if collection or type is missing #}
{% macro filterPostsByType(collection, type) %}
  {% if not collection or not type %}
    {{ [] }}
  {% else %}
    {% set filtered = [] %}
    {% for post in collection | reverse %}
      {% if post.data.type == type %}
        {% set filtered = filtered | push(post) %}
      {% endif %}
    {% endfor %}
    {{ filtered }}
  {% endif %}
{% endmacro %}

{# Filters portfolio items based on featured status
   Args:
     portfolio: The portfolio collection containing all projects
     featured: Array of featured project IDs or null
   Returns:
     Either featured portfolio items or non-featured items
   Note:
     When featured is provided, returns only those specific items
     When featured is null, returns all non-template, non-featured items
     Returns empty array if portfolio is missing #}
{% macro filterPortfolioItems(portfolio, featured) %}
  {% if not portfolio %}
    {{ [] }}
  {% else %}
    {% if featured %}
      {% set filtered = [] %}
      {% for feature in featured %}
        {% if portfolio[feature] %}
          {% set filtered = filtered | push(portfolio[feature]) %}
        {% endif %}
      {% endfor %}
      {{ filtered }}
    {% else %}
      {% set filtered = [] %}
      {% for id, item in portfolio %}
        {% if not item.template and not item.featured %}
          {% set filtered = filtered | push(item) %}
        {% endif %}
      {% endfor %}
      {{ filtered }}
    {% endif %}
  {% endif %}
{% endmacro %}